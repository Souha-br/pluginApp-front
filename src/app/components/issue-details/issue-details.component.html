<div class="issue-details-container">
  <div *ngIf="loading" class="loading-state">
    <div class="spinner"></div>
    <p>Chargement des détails du ticket...</p>
  </div>

  <div *ngIf="!loading && errorMessage" class="empty-state">
    <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
      <polyline points="14 2 14 8 20 8"/>
    </svg>
    <h3>Erreur</h3>
    <p>{{ errorMessage }}</p>
    <button class="back-button" (click)="goBack()">
      <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <path d="M19 12H5"/><path d="M12 19l-7-7 7-7"/>
      </svg>
      Retour à la liste
    </button>
  </div>

  <div *ngIf="!loading && issue" class="issue-content-wrapper">
    <header class="issue-details-header">
      <div class="header-left">
        <div class="project-icon">
          <img src="assets/projectavatar.svg" alt="Project Icon" />
        </div>
        <div>
          <div class="project-path">
            {{ issue.projectName }} / {{ issue.projectKey }}-{{ issue.key }}
          </div>
          <h1 class="issue-summary">{{ issue.summary }}</h1>
        </div>
      </div>
      <div class="header-right">
        <div class="pagination-info">1 sur 14</div>
        <button class="nav-button">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M15 18l-6-6 6-6"/>
          </svg>
        </button>
        <button class="nav-button">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M9 18l6-6-6-6"/>
          </svg>
        </button>
        <button class="back-to-search-button" (click)="goBack()">
          Revenir à la recherche
        </button>
      </div>
    </header>

    <div class="action-buttons">
      <button class="action-button">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M12 20h9"/><path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z"/>
        </svg>
        Modifier
      </button>
      <button class="action-button">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/>
        </svg>
        Ajouter un commentaire
      </button>
      <button class="action-button">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M22 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/>
        </svg>
        Attribuer
      </button>
      <div class="dropdown">
        <button class="action-button dropdown-toggle">
          Plus
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M6 9l6 6 6-6"/>
          </svg>
        </button>
      </div>
      <div class="dropdown">
        <button class="action-button dropdown-toggle">
          À faire
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M6 9l6 6 6-6"/>
          </svg>
        </button>
      </div>
      <div class="dropdown">
        <button class="action-button dropdown-toggle">
          Gérer
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M6 9l6 6 6-6"/>
          </svg>
        </button>
      </div>
      <button class="action-button icon-only">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <circle cx="18" cy="5" r="3"/><circle cx="6" cy="12" r="3"/><circle cx="18" cy="19" r="3"/><line x1="8.59" y1="13.51" x2="15.42" y2="17.49"/><line x1="15.41" y1="6.51" x2="8.59" y2="10.49"/>
        </svg>
      </button>
      <div class="dropdown">
        <button class="action-button dropdown-toggle">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/>
          </svg>
          Exporter
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M6 9l6 6 6-6"/>
          </svg>
        </button>
      </div>
    </div>

    <div class="main-content-grid">
      <div class="left-column">
        <div class="card">
          <div class="card-header">
            <h2 class="card-title">Informations</h2>
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M6 9l6 6 6-6"/>
            </svg>
          </div>
          <div class="card-content grid-2-cols">
            <div class="info-item">
              <span class="label">Type:</span>
              <div class="value-with-icon">
                <div class="issue-type-icon" [ngClass]="getIssueTypeClass(issue.issueType)">
                  {{ getIssueTypeIcon(issue.issueType) }}
                </div>
                <span>{{ issue.issueType }}</span>
              </div>
            </div>
            <div class="info-item">
              <span class="label">Résolution:</span>
              <span class="value">{{ issue.resolution || 'Non résolu' }}</span>
            </div>
            <div class="info-item">
              <span class="label">Priorité:</span>
              <div class="value-with-icon">
                <ng-container [ngSwitch]="getPriorityClass(issue.priority)">
                  <svg *ngSwitchCase="'blocker'" xmlns="http://www.w3.org/2000/svg" width="15" height="16" viewBox="2 0 24 24" fill="currentColor" class="priority-icon blocker">
                    <path d="M12 2L22 12L12 22L2 12L12 2Z"/>
                  </svg>
                  <svg *ngSwitchCase="'high'" xmlns="http://www.w3.org/2000/svg" width="35" height="35" viewBox="7 5 24 24" fill="currentColor" class="priority-icon high">
                    <path d="M7 14L12 9L17 14H7Z"/>
                  </svg>
                  <svg *ngSwitchCase="'medium'" xmlns="http://www.w3.org/2000/svg" width="50" height="40" viewBox="12 5 24 24" fill="currentColor" class="priority-icon medium">
                    <path d="M8 11H16V13H8V11Z"/>
                  </svg>
                  <svg *ngSwitchCase="'low'" xmlns="http://www.w3.org/2000/svg" width="35" height="35" viewBox="7 5 24 24" fill="currentColor" class="priority-icon low">
                    <path d="M17 10L12 15L7 10H17Z"/>
                  </svg>
                  <svg *ngSwitchCase="'minor'" xmlns="http://www.w3.org/2000/svg" width="40" height="40" viewBox="9 5 24 24" fill="currentColor" class="priority-icon minor">
                    <circle cx="12" cy="12" r="3"/>
                  </svg>
                  <svg *ngSwitchDefault xmlns="http://www.w3.org/2000/svg" width="50" height="40" viewBox="12 5 24 24" fill="currentColor" class="priority-icon medium">
                    <path d="M8 11H16V13H8V11Z"/>
                  </svg>
                </ng-container>
                <span>{{ issue.priority }}</span>
              </div>
            </div>
            <div class="info-item">
              <span class="label">Étiquettes:</span>
              <span class="value">{{ issue.labels && issue.labels.length > 0 ? issue.labels.join(', ') : 'Aucune' }}</span>
            </div>
          </div>
        </div>

        <div class="card">
          <div class="card-header">
            <h2 class="card-title">Description</h2>
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M6 9l6 6 6-6"/>
            </svg>
          </div>
          <div class="card-content">
            <p *ngIf="issue.description">{{ issue.description }}</p>
            <p *ngIf="!issue.description" class="italic-text">Cliquer pour ajouter une description</p>
          </div>
        </div>

        <div class="card">
          <div class="card-header">
            <h2 class="card-title">Pièces jointes</h2>
            <div class="header-actions">
              <button class="icon-button">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <circle cx="12" cy="12" r="10"/><path d="M12 16v-4"/><path d="M12 8h.01"/>
                </svg>
              </button>
              <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M6 9l6 6 6-6"/>
              </svg>
            </div>
          </div>
          <div class="card-content">
            <div class="attachment-dropzone">
              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M21.44 11.05l-9.19 9.19a6 6 0 0 1-8.49-8.49l9.19-9.19a4 4 0 0 1 5.66 5.66l-9.2 9.19a2 2 0 0 1-2.83-2.83l8.49-8.48"/>
              </svg>
              <p>Glissez-déposez des fichiers pour les joindre, ou <span class="link-text">parcourir</span>.</p>
            </div>
          </div>
        </div>
      </div>

      <div class="right-column">
        <div class="card">
          <div class="card-header">
            <h2 class="card-title">Personnes</h2>
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M6 9l6 6 6-6"/>
            </svg>
          </div>
          <div class="card-content space-y-4">
            <div class="person-item">
              <span class="label">Personne assignée:</span>
              <div class="value-with-icon">
                <ng-container *ngIf="issue.assignee; else unassigned">
                  <div class="avatar">{{ getAssigneeInitial(issue.assignee) }}</div>
                  <span>{{ getAssigneeDisplayName(issue.assignee) }}</span>
                </ng-container>
                <ng-template #unassigned>
                  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <circle cx="12" cy="12" r="10"/><path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"/><path d="M12 17h.01"/>
                  </svg>
                  <span>Non attribuée</span>
                </ng-template>
              </div>
            </div>
            <button *ngIf="!issue.assignee" class="link-button">Me l'affecter</button>

            <div class="person-item">
              <span class="label">Rapporteur:</span>
              <div class="value-with-icon">
                <ng-container *ngIf="issue.reporter; else noReporter">
                  <div class="avatar">{{ issue.reporter.charAt(0).toUpperCase() }}</div>
                  <span>{{ issue.reporter }}</span>
                  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <circle cx="12" cy="12" r="10"/><path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"/><path d="M12 17h.01"/>
                  </svg>
                </ng-container>
                <ng-template #noReporter>
                  <span class="italic-text">Non défini</span>
                </ng-template>
              </div>
            </div>

            <div class="person-item">
              <span class="label">Votes:</span>
              <span class="value">{{ issue.votes }}</span>
            </div>

            <div class="person-item">
              <span class="label">Gérer les observateurs:</span>
              <div class="value-with-icon">
                <span class="watcher-count">{{ issue.watchers }}</span>
                <button class="link-button">Arrêter l'observation de ce ticket</button>
              </div>
            </div>
          </div>
        </div>

        <div class="card">
          <div class="card-header">
            <h2 class="card-title">Dates</h2>
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M6 9l6 6 6-6"/>
            </svg>
          </div>
          <div class="card-content space-y-4">
            <div class="date-item">
              <span class="label">Création:</span>
              <div class="value-with-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/>
                </svg>
                <span>{{ formatDate(issue.created) }}</span>
              </div>
            </div>
            <div class="date-item">
              <span class="label">Mise à jour:</span>
              <div class="value-with-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/>
                </svg>
                <span>{{ formatDate(issue.updated) }}</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
